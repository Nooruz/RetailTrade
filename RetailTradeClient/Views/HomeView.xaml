<UserControl xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="RetailTradeClient.Views.HomeView"
             xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
             xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
             xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"
             Focusable="True"
             IsTabStop="True"
             Loaded="UserControl_Loaded">

    <dxmvvm:Interaction.Behaviors>
        <dxmvvm:EventToCommand EventName="TextInput" 
                               Command="{Binding TextInputCommand}"
                               PassEventArgsToCommand="True"/>
        <dxmvvm:EventToCommand EventName="KeyDown"
                               Command="{Binding KeyDownCommand}"
                               PassEventArgsToCommand="True"/>
    </dxmvvm:Interaction.Behaviors>

    <UserControl.InputBindings>

        <KeyBinding Key="Escape"
                    Command="{Binding LogoutCommand}"/>

        <KeyBinding Key="F5"
                    Command="{Binding PaymentCashCommand}"/>

        <KeyBinding Key="F6"
                    Command="{Binding PaymentCashlessCommand}"/>

        <KeyBinding Key="F5" 
                    Modifiers="Alt"
                    Command="{Binding PostponeReceiptCommand}"/>

        <KeyBinding Key="F5" 
                    Modifiers="Ctrl"
                    Command="{Binding OpenPostponeReceiptCommand}"/>

        <KeyBinding Key="Delete"
                    Command="{Binding DeleteSelectedRowCommand}"/>

    </UserControl.InputBindings>

    <dxlc:LayoutControl Orientation="Vertical"
                        Padding="0">

        <dxlc:LayoutGroup VerticalAlignment="Top">

            <Menu VerticalAlignment="Top"
                  HorizontalAlignment="Left">
                <MenuItem Header="Файл">
                    <MenuItem Header="Закрыть приложение"/>
                </MenuItem>
                <MenuItem Header="Смена">
                    <MenuItem Header="Печатать Х отчет"
                              Command="{Binding PrintXReportCommand}"/>
                    <MenuItem Header="Закрыть смену Z отчет"
                              Command="{Binding ClosingShiftCommand}"/>
                </MenuItem>
                <MenuItem Header="ККМ">
                    <MenuItem Header="Печатать Х отчет"/>
                    <MenuItem Header="Продолжить печать"/>
                    <MenuItem Header="Анулировать чек"/>
                    <MenuItem Header="Состояние ККМ"/>
                    <MenuItem Header="Закрыть смену Z отчет"/>
                    <MenuItem Header="Настройки ККМ"
                              Command="{Binding CRMSettingsCommand}"/>
                </MenuItem>
                <MenuItem Header="Настройки">
                    <MenuItem Header="Принтеры"
                          Command="{Binding PrinterSettingsCommand}"/>
                </MenuItem>
            </Menu>

            <TextBlock Text="{Binding Info}"/>

        </dxlc:LayoutGroup>

        <dxlc:LayoutGroup Orientation="Horizontal">

            <dxlc:LayoutGroup Orientation="Vertical">

                <dxlc:LayoutGroup Orientation="Vertical"
                                  VerticalAlignment="Top">
                    
                    <dxlc:LayoutItem Label="Всего:" 
                                     Style="{StaticResource liCash}"
                                     FontSize="38">
                        <dxe:TextEdit Text="{Binding Sum, UpdateSourceTrigger=PropertyChanged}"
                                      Style="{StaticResource teCash}"
                                      IsReadOnly="True"
                                      FontSize="46"
                                      BorderThickness="0"/>
                    </dxlc:LayoutItem>
                    
                    <dxlc:LayoutItem Label="Скидка:"
                                     Style="{StaticResource liCash}"
                                     FontSize="38">
                        <dxe:TextEdit Style="{StaticResource teCash}"
                                      IsReadOnly="True"
                                      FontSize="46"
                                      BorderThickness="0"/>
                    </dxlc:LayoutItem>
                    
                    <dxlc:LayoutItem Label="К оплате:"
                                     Style="{StaticResource liCash}"
                                     FontSize="38">
                        <dxe:TextEdit Text="{Binding Sum, UpdateSourceTrigger=PropertyChanged}"
                                      Style="{StaticResource teCash}"
                                      IsReadOnly="True"
                                      FontSize="46"
                                      BorderThickness="0"/>
                    </dxlc:LayoutItem>
                    
                </dxlc:LayoutGroup>

                <ListView Style="{StaticResource lvWithoutBarcode}"
                          Margin="-2.5 0"
                          ItemsSource="{Binding Products}"/>

            </dxlc:LayoutGroup>

            <dxlc:LayoutGroup Orientation="Vertical">

                <dxlc:LayoutGroup Orientation="Horizontal"
                                  VerticalAlignment="Top">

                    <Button Content="Наличными (F5)"
                            Style="{StaticResource ButtonWithIcon}"
                            Tag="{StaticResource faMoneyBillAlt}"
                            Command="{Binding PaymentCashCommand}"/>

                    <Button Content="Безнал. (F6)"
                            Style="{StaticResource ButtonWithIcon}"
                            Tag="{StaticResource faCreditCard}"
                            ToolTip="Оплата безналичными"/>

                    <Button Content="Возврат (F7)"
                            Style="{StaticResource ButtonWithIcon}"
                            Tag="{StaticResource faUndoAlt}"/>

                    <Button Content="Отложить чек (Alt + F5)"
                            Style="{StaticResource ButtonWithIcon}"
                            Tag="{StaticResource faUserClock}"
                            Command="{Binding PostponeReceiptCommand}"/>

                    <Button Content="Отлож.ые чеки (Ctrl + F5)"
                            Style="{StaticResource ButtonWithIcon}"
                            Tag="{StaticResource faUserClock}"
                            Command="{Binding OpenPostponeReceiptCommand}"/>

                    <Button Content="Выход (Esc)"
                            Style="{StaticResource ButtonWithIcon}"
                            Tag="{StaticResource faSignOutAlt}"
                            Command="{Binding LogoutCommand}"/>

                </dxlc:LayoutGroup>

                <dxg:GridControl ItemsSource="{Binding SaleProducts}"                                 
                                 SelectedItem="{Binding SelectedProductSale}">
                    <dxg:GridControl.View>
                        <dxg:TableView AutoWidth="True"
                                       ShowGroupPanel="False" 
                                       AllowSorting="False"
                                       AllowDrop="False"
                                       NavigationStyle="Cell"
                                       FocusedRowHandle="{Binding FocusedRowHandle}"
                                       FocusedRowHandleChanged="TableView_FocusedRowHandleChanged"
                                       AllowDragDrop="False"
                                       AllowGrouping="False"/>
                    </dxg:GridControl.View>
                    <dxg:GridColumn Header="Код" 
                                    AllowColumnFiltering="False"
                                    FieldName="Id"
                                    AllowEditing="False">
                        <dxg:GridColumn.EditSettings>
                            <dxe:TextEditSettings DisplayFormat="D6"/>
                        </dxg:GridColumn.EditSettings>
                    </dxg:GridColumn>
                    <dxg:GridColumn Header="Номенклатура" 
                                    FieldName="Name"
                                    AllowColumnFiltering="False"
                                    AllowEditing="False"/>
                    <dxg:GridColumn Header="Количество" 
                                    IsSmart="True"
                                    Binding="{Binding Quantity, Mode=TwoWay}">
                        <dxg:GridColumn.EditSettings>
                            <dxe:ButtonEditSettings SelectAllOnMouseUp="True"/>
                        </dxg:GridColumn.EditSettings>
                    </dxg:GridColumn>
                    <dxg:GridColumn Header="Цена" 
                                    FieldName="SalePrice"
                                    AllowColumnFiltering="False"
                                    AllowEditing="False">
                        <dxg:GridColumn.EditSettings>
                            <dxe:TextEditSettings DisplayFormat="N2"/>
                        </dxg:GridColumn.EditSettings>
                    </dxg:GridColumn>
                    <dxg:GridColumn Header="Сумма" 
                                    FieldName="Sum"
                                    AllowColumnFiltering="False"
                                    AllowEditing="False">
                        <dxg:GridColumn.EditSettings>
                            <dxe:TextEditSettings DisplayFormat="N2"/>
                        </dxg:GridColumn.EditSettings>
                    </dxg:GridColumn>
                </dxg:GridControl>

            </dxlc:LayoutGroup>

        </dxlc:LayoutGroup>

    </dxlc:LayoutControl>

</UserControl>
